name: Validating Unity Catalog Metadata Files

on:
  workflow_call:
    inputs:
      base_rev:
        description: branch or commit used as base for compare
        required: true
        type: string
      head_rev:
        description: branch or commit used as head for compare
        required: true
        type: string

permissions: # ver si es necesario esto
  # From
  # https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services#adding-permissions-settings
  id-token: write
  contents: read

jobs:
  
  changed-metadata-files:
    name: Get modified metadata files
    uses: mac87-git/templates-github-actions/.github/workflows/wf-get-changed-metadata-files.yml@main
    with:
      base_rev: ${{ inputs.base_rev }}
      head_rev: ${{ inputs.head_rev }}

  validate-metadata-files:
    runs-on: ubuntu-latest
    needs: changed-metadata-files
    if: ${{ needs.changed-metadata-files.outputs.changed != '' }}
    steps:
      - uses: actions/checkout@v4 # ver si es necesario este paso
      - name: Validate metadata yml files
        uses: mac87-git/templates-github-actions/.github/actions/validate-uc-metadata-files@main
        with:
          changed: ${{ needs.changed-metadata-files.outputs.changed }}  
